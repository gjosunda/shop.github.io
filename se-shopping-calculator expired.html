<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sverigehandel – kalkulator</title>
  <style>
    :root {{
      --bg: #0b1220;
      --card: #111a2c;
      --accent: #5dd0ff;
      --muted: #9fb0c3;
      --text: #eef6ff;
      --ok: #38d39f;
      --warn: #ffd166;
      --border: rgba(255,255,255,.1);
    }}
    html,body {{ margin:0; padding:0; background:linear-gradient(160deg, #0a0f1f 0%, #0b1220 60%, #0e1630 100%); color:var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }}
    .wrap {{ max-width: 1200px; margin: 0 auto; padding: 24px 16px 48px; }}
    header {{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:16px; }}
    .brand {{ display:flex; align-items:center; gap:10px; }}
    .logo {{ width:36px; height:36px; border-radius:12px; background: radial-gradient(circle at 30% 30%, var(--accent), #7ee0ff 35%, #2a91ff 70%, #0056b3 100%); box-shadow: 0 10px 30px rgba(93,208,255,.35); }}
    h1 {{ font-size: clamp(22px, 4vw, 32px); margin:0; letter-spacing:.3px; }}
    a.link {{ color: var(--accent); text-decoration: none; }}
    .sub {{ color:var(--muted); font-size:14px; }}
    .card {{ background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); border:1px solid var(--border); border-radius:16px; padding:16px; backdrop-filter: blur(6px); box-shadow: 0 6px 28px rgba(0,0,0,.25); margin-bottom:14px; }}
    .row {{ display:flex; gap:12px; align-items:center; flex-wrap:wrap; }}
    label {{ color:var(--muted); }}
    input, select {{ background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); color:var(--text); padding:8px 10px; border-radius:10px; outline:none; }}
    input[type=number] {{ width: 120px; }}
    table {{ width:100%; border-collapse: collapse; margin-top:10px; font-size: 14px; }}
    th, td {{ border: 1px solid rgba(255,255,255,.08); padding: 8px; }}
    th {{ background: rgba(255,255,255,.06); position: sticky; top: 0; z-index: 1; }}
    td.num {{ text-align: right; font-variant-numeric: tabular-nums; }}
    td.center {{ text-align: center; }}
    .okbg {{ background: rgba(56,211,159,.12); }}
    .warnbg {{ background: rgba(255,209,102,.12); }}
    .btn {{ appearance:none; border:1px solid rgba(255,255,255,.18); background:rgba(93,208,255,.1); color:var(--text); padding:10px 14px; border-radius:12px; text-decoration:none; font-weight:600; transition:.2s transform, .2s background; }}
    .btn:hover {{ transform: translateY(-1px); background: rgba(93,208,255,.18); }}
    .btn.primary {{ background:linear-gradient(180deg, #5dd0ff, #2a91ff); border-color: transparent; color:#001121; }}
    .muted {{ color: var(--muted); font-size: 13px; }}
    .grid {{ display:grid; grid-template-columns: 1fr; gap: 10px; }}
    @media (min-width: 900px) {{ .grid {{ grid-template-columns: 1fr 1fr; }} }}
    .summary {{ display:flex; gap:18px; flex-wrap:wrap; }}
    .chip {{ background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); border-radius: 12px; padding:8px 12px; }}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Sverigehandel – kalkulator</h1>
          <div class="sub">Sammenlign norske og svenske priser (enhetspris kr/kg eller kr/L)</div>
        </div>
      </div>
      <a class="link" href="index.html">← Til forsiden</a>
    </header>

    <section class="card grid">
      <div class="row">
        <label for="rate">Valutakurs: 1 SEK = </label>
        <input id="rate" type="number" step="0.001" value="1.065">
        <span>NOK</span>
        <button class="btn" onclick="saveRate()">Lagre kurs</button>
        <span class="muted">Kalkulatoren bruker denne til SEK→NOK.</span>
      </div>
      <div class="summary">
        <div class="chip">Totalt (SE, NOK): <strong id="sumSeNok">–</strong></div>
        <div class="chip">Totalt (NO, NOK): <strong id="sumNoNok">–</strong></div>
        <div class="chip">Besparelse (NOK): <strong id="saveNok">–</strong></div>
      </div>
    </section>

    <section class="card">
      <div class="row" style="justify-content: space-between;">
        <div class="muted">Rediger rader fritt. "Billigere?" blir grønn når Sverige er rimeligst.</div>
        <div class="row">
          <button class="btn" onclick="addRow()">+ Legg til vare</button>
          <button class="btn" onclick="exportJson()">Eksporter JSON</button>
        </div>
      </div>

      <div style="overflow:auto; max-height: 70vh; border-radius: 12px; margin-top:10px;">
        <table id="tbl">
          <thead>
            <tr>
              <th>Beskrivelse</th>
              <th>Enhet</th>
              <th>Nettovekt (g/ml)</th>
              <th>SE kjede/butikk</th>
              <th>SE pris (SEK)</th>
              <th>NO pris (NOK)</th>
              <th>SE kr/kg/L</th>
              <th>SE kr/kg/L (NOK)</th>
              <th>NO kr/kg/L</th>
              <th>Billigere i SE?</th>
              <th>Diff %</th>
            </tr>
          </thead>
          <tbody>
<tr>
  <td><input value="Melk lett 1L"></td>
  <td><select><option value="g">g</option><option value="ml" selected>ml</option></select></td>
  <td><input type="number" value="1000"></td>
  <td><input value="Willys"></td>
  <td><input type="number" step="0.01" value="13.5"></td>
  <td><input type="number" step="0.01" value="20.9"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

<tr>
  <td><input value="Yoghurt naturell 1kg"></td>
  <td><select><option value="g" selected>g</option><option value="ml">ml</option></select></td>
  <td><input type="number" value="1000"></td>
  <td><input value="Coop"></td>
  <td><input type="number" step="0.01" value="25.0"></td>
  <td><input type="number" step="0.01" value="39.9"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

<tr>
  <td><input value="Norvegia gulost 1kg"></td>
  <td><select><option value="g" selected>g</option><option value="ml">ml</option></select></td>
  <td><input type="number" value="1000"></td>
  <td><input value="ICA"></td>
  <td><input type="number" step="0.01" value="110.0"></td>
  <td><input type="number" step="0.01" value="149.0"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

<tr>
  <td><input value="Brunost 1kg"></td>
  <td><select><option value="g" selected>g</option><option value="ml">ml</option></select></td>
  <td><input type="number" value="1000"></td>
  <td><input value="Mathem"></td>
  <td><input type="number" step="0.01" value="95.0"></td>
  <td><input type="number" step="0.01" value="109.0"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

<tr>
  <td><input value="Smør 500g"></td>
  <td><select><option value="g" selected>g</option><option value="ml">ml</option></select></td>
  <td><input type="number" value="500"></td>
  <td><input value="Coop"></td>
  <td><input type="number" step="0.01" value="65.0"></td>
  <td><input type="number" step="0.01" value="59.9"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

<tr>
  <td><input value="Kaffe filtermalt 500g"></td>
  <td><select><option value="g" selected>g</option><option value="ml">ml</option></select></td>
  <td><input type="number" value="500"></td>
  <td><input value="Coop"></td>
  <td><input type="number" step="0.01" value="65.0"></td>
  <td><input type="number" step="0.01" value="110.0"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

<tr>
  <td><input value="Pulverkaffe 200g"></td>
  <td><select><option value="g" selected>g</option><option value="ml">ml</option></select></td>
  <td><input type="number" value="200"></td>
  <td><input value="Mathem"></td>
  <td><input type="number" step="0.01" value="69.0"></td>
  <td><input type="number" step="0.01" value="135.0"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

<tr>
  <td><input value="Spaghetti 1kg (budsjett)"></td>
  <td><select><option value="g" selected>g</option><option value="ml">ml</option></select></td>
  <td><input type="number" value="1000"></td>
  <td><input value="Coop"></td>
  <td><input type="number" step="0.01" value="18.0"></td>
  <td><input type="number" step="0.01" value="22.0"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

<tr>
  <td><input value="Pasta penne 1kg (merke)"></td>
  <td><select><option value="g" selected>g</option><option value="ml">ml</option></select></td>
  <td><input type="number" value="1000"></td>
  <td><input value="Coop"></td>
  <td><input type="number" step="0.01" value="24.9"></td>
  <td><input type="number" step="0.01" value="59.0"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

<tr>
  <td><input value="Knekkebrød 300g"></td>
  <td><select><option value="g" selected>g</option><option value="ml">ml</option></select></td>
  <td><input type="number" value="300"></td>
  <td><input value="ICA"></td>
  <td><input type="number" step="0.01" value="18.0"></td>
  <td><input type="number" step="0.01" value="22.0"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

<tr>
  <td><input value="Ris jasmin 1kg"></td>
  <td><select><option value="g" selected>g</option><option value="ml">ml</option></select></td>
  <td><input type="number" value="1000"></td>
  <td><input value="Willys"></td>
  <td><input type="number" step="0.01" value="25.0"></td>
  <td><input type="number" step="0.01" value="45.0"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

<tr>
  <td><input value="Sukker 1kg"></td>
  <td><select><option value="g" selected>g</option><option value="ml">ml</option></select></td>
  <td><input type="number" value="1000"></td>
  <td><input value="ICA"></td>
  <td><input type="number" step="0.01" value="15.0"></td>
  <td><input type="number" step="0.01" value="35.0"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

<tr>
  <td><input value="Hvetemel siktet 2kg"></td>
  <td><select><option value="g" selected>g</option><option value="ml">ml</option></select></td>
  <td><input type="number" value="2000"></td>
  <td><input value="Willys"></td>
  <td><input type="number" step="0.01" value="20.0"></td>
  <td><input type="number" step="0.01" value="25.0"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

<tr>
  <td><input value="Poteter 2.5kg"></td>
  <td><select><option value="g" selected>g</option><option value="ml">ml</option></select></td>
  <td><input type="number" value="2500"></td>
  <td><input value="Coop"></td>
  <td><input type="number" step="0.01" value="35.0"></td>
  <td><input type="number" step="0.01" value="60.0"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

<tr>
  <td><input value="Tomater 1kg"></td>
  <td><select><option value="g" selected>g</option><option value="ml">ml</option></select></td>
  <td><input type="number" value="1000"></td>
  <td><input value="Coop"></td>
  <td><input type="number" step="0.01" value="60.0"></td>
  <td><input type="number" step="0.01" value="50.0"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

<tr>
  <td><input value="Bananer 1kg"></td>
  <td><select><option value="g" selected>g</option><option value="ml">ml</option></select></td>
  <td><input type="number" value="1000"></td>
  <td><input value="ICA"></td>
  <td><input type="number" step="0.01" value="22.0"></td>
  <td><input type="number" step="0.01" value="32.0"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

<tr>
  <td><input value="Agurk 1 stk (~350g)"></td>
  <td><select><option value="g" selected>g</option><option value="ml">ml</option></select></td>
  <td><input type="number" value="350"></td>
  <td><input value="Willys"></td>
  <td><input type="number" step="0.01" value="10.0"></td>
  <td><input type="number" step="0.01" value="34.0"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

<tr>
  <td><input value="Appelsinjuice 1.5L"></td>
  <td><select><option value="g">g</option><option value="ml" selected>ml</option></select></td>
  <td><input type="number" value="1500"></td>
  <td><input value="ICA"></td>
  <td><input type="number" step="0.01" value="25.0"></td>
  <td><input type="number" step="0.01" value="47.0"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

<tr>
  <td><input value="Eplejuice 1L"></td>
  <td><select><option value="g">g</option><option value="ml" selected>ml</option></select></td>
  <td><input type="number" value="1000"></td>
  <td><input value="ICA"></td>
  <td><input type="number" step="0.01" value="17.0"></td>
  <td><input type="number" step="0.01" value="26.0"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

<tr>
  <td><input value="Rapsolje 1L"></td>
  <td><select><option value="g">g</option><option value="ml" selected>ml</option></select></td>
  <td><input type="number" value="1000"></td>
  <td><input value="Willys"></td>
  <td><input type="number" step="0.01" value="29.0"></td>
  <td><input type="number" step="0.01" value="39.0"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

<tr>
  <td><input value="Olivenolje 1L"></td>
  <td><select><option value="g">g</option><option value="ml" selected>ml</option></select></td>
  <td><input type="number" value="1000"></td>
  <td><input value="Coop"></td>
  <td><input type="number" step="0.01" value="89.0"></td>
  <td><input type="number" step="0.01" value="119.0"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

<tr>
  <td><input value="Ketchup 1kg (≈1L)"></td>
  <td><select><option value="g" selected>g</option><option value="ml">ml</option></select></td>
  <td><input type="number" value="1000"></td>
  <td><input value="Willys"></td>
  <td><input type="number" step="0.01" value="25.0"></td>
  <td><input type="number" step="0.01" value="39.0"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

<tr>
  <td><input value="Majones 0.9L"></td>
  <td><select><option value="g">g</option><option value="ml" selected>ml</option></select></td>
  <td><input type="number" value="900"></td>
  <td><input value="ICA"></td>
  <td><input type="number" step="0.01" value="35.0"></td>
  <td><input type="number" step="0.01" value="39.0"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

<tr>
  <td><input value="Gulost skivet 450g"></td>
  <td><select><option value="g" selected>g</option><option value="ml">ml</option></select></td>
  <td><input type="number" value="450"></td>
  <td><input value="Coop"></td>
  <td><input type="number" step="0.01" value="59.0"></td>
  <td><input type="number" step="0.01" value="89.0"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

<tr>
  <td><input value="Kokt skinke 150g"></td>
  <td><select><option value="g" selected>g</option><option value="ml">ml</option></select></td>
  <td><input type="number" value="150"></td>
  <td><input value="Coop"></td>
  <td><input type="number" step="0.01" value="25.0"></td>
  <td><input type="number" step="0.01" value="37.0"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

<tr>
  <td><input value="Kjøttdeig 14% 400g"></td>
  <td><select><option value="g" selected>g</option><option value="ml">ml</option></select></td>
  <td><input type="number" value="400"></td>
  <td><input value="Willys"></td>
  <td><input type="number" step="0.01" value="45.0"></td>
  <td><input type="number" step="0.01" value="75.0"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

<tr>
  <td><input value="Kyllingfilet 700g"></td>
  <td><select><option value="g" selected>g</option><option value="ml">ml</option></select></td>
  <td><input type="number" value="700"></td>
  <td><input value="Coop"></td>
  <td><input type="number" step="0.01" value="89.0"></td>
  <td><input type="number" step="0.01" value="125.0"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

<tr>
  <td><input value="Pølser 600g"></td>
  <td><select><option value="g" selected>g</option><option value="ml">ml</option></select></td>
  <td><input type="number" value="600"></td>
  <td><input value="ICA"></td>
  <td><input type="number" step="0.01" value="39.0"></td>
  <td><input type="number" step="0.01" value="55.0"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

<tr>
  <td><input value="Fiskepinner 450g"></td>
  <td><select><option value="g" selected>g</option><option value="ml">ml</option></select></td>
  <td><input type="number" value="450"></td>
  <td><input value="Willys"></td>
  <td><input type="number" step="0.01" value="35.0"></td>
  <td><input type="number" step="0.01" value="49.0"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

<tr>
  <td><input value="Laks fersk 1kg"></td>
  <td><select><option value="g" selected>g</option><option value="ml">ml</option></select></td>
  <td><input type="number" value="1000"></td>
  <td><input value="Coop"></td>
  <td><input type="number" step="0.01" value="149.0"></td>
  <td><input type="number" step="0.01" value="199.0"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="num"></td>
  <td class="center"></td>
  <td class="num"></td>
</tr>

          </tbody>
        </table>
      </div>
    </section>

    <section class="card">
      <div class="muted">Tips: Endre <em>valutakurs</em> eller svenske priser når du står i butikken. Enhetspris regnes automatisk og sammenlignes mot Norge.</div>
    </section>
  </div>

  <script>
    function getRate(){{
      const saved = parseFloat(localStorage.getItem('sek_to_nok'));
      const inp = document.getElementById('rate');
      if(!isNaN(saved) && saved>0) {{ inp.value = saved; }}
      return parseFloat(inp.value)||0;
    }}
    function saveRate(){{
      const v = parseFloat(document.getElementById('rate').value);
      if(!isNaN(v) && v>0) localStorage.setItem('sek_to_nok', String(v));
      recalc();
    }}

    function recalc(){{
      const rate = getRate();
      let sumSeNok = 0;
      let sumNoNok = 0;

      const rows = document.querySelectorAll('#tbl tbody tr');
      rows.forEach(tr => {{
        const unit = tr.children[1].querySelector('select').value;
        const size = parseFloat(tr.children[2].querySelector('input').value) || 0;
        const se   = parseFloat(tr.children[4].querySelector('input').value) || 0;
        const no   = parseFloat(tr.children[5].querySelector('input').value) || 0;

        const perFactor = size ? (1000.0 / size) : 0;
        const sePerUnitSEK = se * perFactor;
        const sePerUnitNOK = sePerUnitSEK * rate;
        const noPerUnitNOK = no * perFactor;

        tr.children[6].textContent = se ? sePerUnitSEK.toFixed(2) : '';
        tr.children[7].textContent = se ? sePerUnitNOK.toFixed(2) : '';
        tr.children[8].textContent = no ? noPerUnitNOK.toFixed(2) : '';

        if (se && no) {{
          const cheaper = sePerUnitNOK < noPerUnitNOK;
          tr.children[9].textContent = cheaper ? "Ja" : "Nei";
          const diff = (noPerUnitNOK - sePerUnitNOK) / noPerUnitNOK;
          tr.children[10].textContent = (diff*100).toFixed(1) + "%";
          tr.classList.toggle('okbg', cheaper);
          tr.classList.toggle('warnbg', !cheaper);
        }} else {{
          tr.children[9].textContent = '';
          tr.children[10].textContent = '';
          tr.classList.remove('okbg','warnbg');
        }}

        // Sum totals (assumes 1 pack each)
        sumSeNok += se * rate;
        sumNoNok += no;
      }});

      document.getElementById('sumSeNok').textContent = sumSeNok ? sumSeNok.toFixed(2) : '–';
      document.getElementById('sumNoNok').textContent = sumNoNok ? sumNoNok.toFixed(2) : '–';
      const save = sumNoNok && sumSeNok ? (sumNoNok - sumSeNok) : 0;
      document.getElementById('saveNok').textContent = (sumNoNok && sumSeNok) ? save.toFixed(2) : '–';
    }}

    function addRow(){{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input></td>
        <td><select><option value="g" selected>g</option><option value="ml">ml</option></select></td>
        <td><input type="number" value="1000"></td>
        <td><input></td>
        <td><input type="number" step="0.01"></td>
        <td><input type="number" step="0.01"></td>
        <td class="num"></td>
        <td class="num"></td>
        <td class="num"></td>
        <td class="center"></td>
        <td class="num"></td>
      `;
      document.querySelector('#tbl tbody').appendChild(tr);
      tr.querySelectorAll('input,select').forEach(el => el.addEventListener('input', recalc));
    }}

    function exportJson(){{
      const rate = getRate();
      const rows = Array.from(document.querySelectorAll('#tbl tbody tr')).map(tr => ({{  // doubled braces for template
        item: tr.children[0].querySelector('input').value,
        unit: tr.children[1].querySelector('select').value,
        size: parseFloat(tr.children[2].querySelector('input').value) || null,
        store: tr.children[3].querySelector('input').value,
        se_price: parseFloat(tr.children[4].querySelector('input').value) || null,
        no_price: parseFloat(tr.children[5].querySelector('input').value) || null
      }}));
      const payload = {{ rate, rows }};
      const blob = new Blob([JSON.stringify(payload, null, 2)], {{type: 'application/json'}});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'sverigehandel_export.json';
      a.click();
      URL.revokeObjectURL(a.href);
    }}

    document.querySelectorAll('input,select').forEach(el => el.addEventListener('input', recalc));
    recalc();
  </script>
</body>
</html>
